import { createStore } from "zustand/vanilla";
import attachActions from "./libraryActions";
import { Resource } from "../types";

export type SelectionMode = "single" | "multiple";

export interface LibraryConfig {
  mode: SelectionMode;
  selectedIds: string[];
}

const mockResources: Resource[] = [
  {
    id: "1",
    name: "Project Proposal.pdf",
    kind: "file",
    mime_type: "application/pdf",
    size: 2048000,
    extension: "pdf",
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-15T10:30:00").toISOString(),
    updated_at: new Date("2024-01-15T10:30:00").toISOString(),
    parent_id: null,
    deleted_at: null,
  },
  {
    id: "2",
    name: "Team Photo.jpg",
    kind: "file",
    mime_type: "image/jpeg",
    size: 1536000,
    extension: "jpg",
    path: null,
    thumbnail_url: "https://picsum.photos/seed/team/200/200",
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-16T14:20:00").toISOString(),
    updated_at: new Date("2024-01-16T14:20:00").toISOString(),
    parent_id: null,
    deleted_at: null,
  },
  {
    id: "3",
    name: "Training Video.mp4",
    kind: "file",
    mime_type: "video/mp4",
    size: 10240000,
    extension: "mp4",
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-2",
    created_at: new Date("2024-01-17T09:15:00").toISOString(),
    updated_at: new Date("2024-01-17T09:15:00").toISOString(),
    parent_id: null,
    deleted_at: null,
  },
  {
    id: "4",
    name: "Budget Spreadsheet.xlsx",
    kind: "file",
    mime_type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
    size: 512000,
    extension: "xlsx",
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-18T11:45:00").toISOString(),
    updated_at: new Date("2024-01-18T11:45:00").toISOString(),
    parent_id: null,
    deleted_at: null,
  },
  {
    id: "5",
    name: "Company Logo.png",
    kind: "file",
    mime_type: "image/png",
    size: 256000,
    extension: "png",
    path: null,
    thumbnail_url: "https://picsum.photos/seed/logo/200/200",
    organization_id: "org-1",
    created_by: "user-2",
    created_at: new Date("2024-01-19T16:00:00").toISOString(),
    updated_at: new Date("2024-01-19T16:00:00").toISOString(),
    parent_id: null,
    deleted_at: null,
  },
  {
    id: "6",
    name: "Meeting Notes.docx",
    kind: "file",
    mime_type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
    size: 128000,
    extension: "docx",
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-20T13:30:00").toISOString(),
    updated_at: new Date("2024-01-20T13:30:00").toISOString(),
    parent_id: null,
    deleted_at: null,
  },
  {
    id: "7",
    name: "Presentation.pptx",
    kind: "file",
    mime_type: "application/vnd.openxmlformats-officedocument.presentationml.presentation",
    size: 3072000,
    extension: "pptx",
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-2",
    created_at: new Date("2024-01-21T10:00:00").toISOString(),
    updated_at: new Date("2024-01-21T10:00:00").toISOString(),
    parent_id: null,
    deleted_at: null,
  },
  {
    id: "8",
    name: "Documents",
    kind: "folder",
    mime_type: null,
    size: null,
    extension: null,
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-10T08:00:00").toISOString(),
    updated_at: new Date("2024-01-10T08:00:00").toISOString(),
    parent_id: null,
    deleted_at: null,
  },
  {
    id: "9",
    name: "Images",
    kind: "folder",
    mime_type: null,
    size: null,
    extension: null,
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-11T08:00:00").toISOString(),
    updated_at: new Date("2024-01-11T08:00:00").toISOString(),
    parent_id: null,
    deleted_at: null,
  },
  {
    id: "10",
    name: "Contract.pdf",
    kind: "file",
    mime_type: "application/pdf",
    size: 1024000,
    extension: "pdf",
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-22T10:00:00").toISOString(),
    updated_at: new Date("2024-01-22T10:00:00").toISOString(),
    parent_id: "8",
    deleted_at: null,
  },
  {
    id: "11",
    name: "Report.docx",
    kind: "file",
    mime_type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
    size: 256000,
    extension: "docx",
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-22T11:00:00").toISOString(),
    updated_at: new Date("2024-01-22T11:00:00").toISOString(),
    parent_id: "8",
    deleted_at: null,
  },
  {
    id: "12",
    name: "Invoice.xlsx",
    kind: "file",
    mime_type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
    size: 384000,
    extension: "xlsx",
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-2",
    created_at: new Date("2024-01-22T12:00:00").toISOString(),
    updated_at: new Date("2024-01-22T12:00:00").toISOString(),
    parent_id: "8",
    deleted_at: null,
  },
  {
    id: "13",
    name: "Banner.jpg",
    kind: "file",
    mime_type: "image/jpeg",
    size: 2048000,
    extension: "jpg",
    path: null,
    thumbnail_url: "https://picsum.photos/seed/banner/200/200",
    organization_id: "org-1",
    created_by: "user-2",
    created_at: new Date("2024-01-23T09:00:00").toISOString(),
    updated_at: new Date("2024-01-23T09:00:00").toISOString(),
    parent_id: "9",
    deleted_at: null,
  },
  {
    id: "14",
    name: "Screenshot.png",
    kind: "file",
    mime_type: "image/png",
    size: 512000,
    extension: "png",
    path: null,
    thumbnail_url: "https://picsum.photos/seed/screenshot/200/200",
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-23T10:00:00").toISOString(),
    updated_at: new Date("2024-01-23T10:00:00").toISOString(),
    parent_id: "9",
    deleted_at: null,
  },
  {
    id: "15",
    name: "Diagram.svg",
    kind: "file",
    mime_type: "image/svg+xml",
    size: 64000,
    extension: "svg",
    path: null,
    thumbnail_url: null,
    organization_id: "org-1",
    created_by: "user-1",
    created_at: new Date("2024-01-23T11:00:00").toISOString(),
    updated_at: new Date("2024-01-23T11:00:00").toISOString(),
    parent_id: "9",
    deleted_at: null,
  },
];

type LibraryStoreState = {
  data: Resource[];
  open: boolean;
  config: LibraryConfig | null;
  resolve: ((resources: Resource[]) => void) | null;
  reject: ((reason?: any) => void) | null;
};

type LibraryStoreActions = {
  openLibrary: (config?: Partial<LibraryConfig>) => Promise<Resource[]>;
  closeLibrary: (resources?: Resource[]) => void;
  cancelLibrary: () => void;
};

type LibraryStore = LibraryStoreState & LibraryStoreActions;

const libraryStateInit: LibraryStoreState = {
  data: mockResources,
  open: false,
  config: null,
  resolve: null,
  reject: null,
};

const createLibraryStore = (initState: LibraryStoreState) => {
  return createStore<LibraryStore>()((set, get) => ({
    ...initState,
    ...attachActions(initState)(set, get),
  }));
};

export { createLibraryStore, libraryStateInit };
export type { LibraryStore, LibraryStoreActions, LibraryStoreState };
